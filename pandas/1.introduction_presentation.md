# **2-2. 데이터프레임**

데이터프레임은 여러 개의 시리즈들이 모인 구조라고 생각하면 된다. 즉, 데이터 프레임의 열은 각각 시리즈 객체이다. 데이터프레임은 행과 열을 나타내기 위해 두 가지 종류의 주소를 사용하는데 행 인덱스(row index)와 열 이름(column name or column label)이다. 

___

## **데이터프레임 만들기**

* pandas.DataFrame(객체)
* 딕셔너리 -> 데이터프레임 변환 : 딕셔너리의 key값이 열이름이 되는 
* 리스트를 원소로 갖는 리스트 -> 데이터 프레임 변환 : 리스트 원소 각각이 행이 되는

|종목 코드|회사 이름|액면가|총 주식수|
|:---:|:---:|:---:|:---:|
|005930|삼성전자|100원|5,970백만 주|
|017670|SK텔레콤|500원|81백만 주|
|005380|현대자동차|5000원|214백만 주|

현재 행은 하나의 주식 종목에 대한 관측값, 열은 주식 종목과 관련된 속성, 범주를 나타낸다. 위와 같은 데이터프레임을 구현해보면 아래와 같다.

1. 딕셔너리를 데이터프레임으로
```python
import pandas as pd
data = {'종목코드':['005930', '017670', '005380'], 
        '회사 이름':['삼성전자', 'SK텔레콤', '현대자동차'],
        '액면가':['100원', '500원', '5000원'],
        '총 주식수':['5970백만 주', '81백만 주', '214백만 주']}
df = pd.DataFrame(data)
print(df)
>>>      종목코드  회사 이름    액면가     총 주식수
>>> 0  005930   삼성전자   100원  5970백만 주
>>> 1  017670  SK텔레콤   500원    81백만 주
>>> 2  005380  현대자동차  5000원   214백만 주
```

여기서 딕셔너리의 key는 각 시리즈의 이름으로 변환되어 최종적으로 데이터프레임의 열 이름이 된다. 또한, 딕셔너리의 value에 해당하는 각 리스트가 시리즈 배열로 변환되어 데이터프레임의 열이 된다. 이 때 행 인덱스에는 정수형 위치 인덱스가 자동 지정된다.

2. 리스트를 원소로 갖는 리스트를 데이터프레임으로
```python
import pandas as pd
df = pd.DataFrame([['005930', '삼성전자', '100원', '5970백만 주'],
                   ['017670', 'SK텔레콤', '500원', '81백만 주'],
                   ['005380', '현대자동차', '5000원', '214백만 주']], columns = ['종목코드', '회사이름', '액면가', '총 주식수'])
print(df)
>>>      종목코드  회사 이름    액면가     총 주식수
>>> 0  005930   삼성전자   100원  5970백만 주
>>> 1  017670  SK텔레콤   500원    81백만 주
>>> 2  005380  현대자동차  5000원   214백만 주
```

이는 실행결과에서 각 리스트의 원소인 리스트가 행으로 반환된다는 점에 유의하면 된다.

___

## **행 인덱스 / 열 이름 설정**
* pandas.DataFrame(2차원 배열, index = 행 인덱스 배열, columns = 열 이름 배열)

2차원 배열을 DataFrame() 함수 인자로 전달하여 데이터프레임으로 변환할 때 행 인덱스와 열 이름 속성을 직접 지정할 수 있다. 예시를 통해 살펴보자.

||나이|성별|학교|
|:---:|:---:|:---:|:---:|
|준서|15|남|덕영중|
|예은|17|여|수리중|

```python
import pandas as pd
df = pd.DataFrame([[15, '남', '덕영중'], [17, '여', '수리중']], 
                 index = ['준서', '예은'],
                 columns = ['나이', '성별', '학교']) 
print(df)
print(df.index)
print(df.columns)
>>>     나이 성별   학교
>>> 준서  15  남  덕영중
>>> 예은  17  여  수리중
>>> Index(['준서', '예은'], dtype='object')
>>> Index(['나이', '성별', '학교'], dtype='object')
```

## **행 인덱스 / 열 이름 변경**
* 행 인덱스 변경 : DataFrame 객체.index = 새로운 행 인덱스 배열
* 열 이름 변경 : DataFrame 객체.columns = 새로운 열 이름 배열

데이터프레임의 행 인덱스와 열 인덱스에 새로운 배열을 할당하는 방식으로 행 인덱스와 열 이름을 변경할 수 있다. 앞의 예제에 적용해보자.

```python
df.index = ['학생1', '학생2']
df.columns = ['연령', '남녀', '소속']
print(df)
print(df.index)
print(df.columns)
>>>      연령 남녀   소속
>>> 학생1  15  남  덕영중
>>> 학생2  17  여  수리중
>>> Index(['학생1', '학생2'], dtype='object')
>>> Index(['연령', '남녀', '소속'], dtype='object')
```
___

## **행 인덱스 / 열 이름 일부 변경**
* 행 인덱스 변경 : DataFrame 객체.rename(index = {기존 인덱스:새 인덱스 , ...})
* 열 이름 변경 : DataFrame 객체.rename(columns = {기존 이름:새 이름, ...})

데이터 프레임에 rename() 메소드를 적용하면 일부 행 인덱스 또는 열 이름을 변경할 수 있다.

```python
import pandas as pd
df = pd.DataFrame([[15, '남', '덕영중'], [17, '여', '수리중']], 
                 index = ['준서', '예은'],
                 columns = ['나이', '성별', '학교'])
df.rename(index = {'준서':'학생1', '예은':'학생2'}, inplace = True)
df.rename(columns = {'나이':'연령', '성별':'남녀', '학교':'소속'}, inplace = True)
print(df)
>>>      연령 남녀   소속
>>> 학생1  15  남  덕영중
>>> 학생2  17  여  수리중
```

이 때 원본 객체를 직접 수정하는 것이 아니라 새로운 데이터프레임 객체를 반환하기 때문에 원본 객체를 변경하기 위해서는 inplace = True라는 옵션을 사용해주어야 한다.

___

## **행 / 열 삭제**
* 행 삭제 : DataFrame 객체.drop(행 인덱스 또는 배열, axis = 0)
* 열 삭제 : DataFrame 객체.drop(열 이름 또는 배열, axis = 1) / 축 옵션 입력 안할 시 오류 발생

데이터프레임 행 또는 열을 삭제하기 위해서는 drop 메소드를 사용한다. 이 때 축 옵션인 axis가 있는데 행 삭제에서는 axis = 0을, 열 삭제에서는 axis = 1을 작성한다. 행 삭제에서는 옵션이 필수는 아니지만, 열 삭제에서는 옵션이 필수이다.

```python
import pandas as pd
df = pd.DataFrame({'수학':[90, 80, 70], '영어':[98, 89, 95], 
                  '음악':[85, 95, 100], '체육':[100, 90, 90]},
                 index = ['서준', '우현', '인아'])
print(df)

df2 = df[:] # df.copy()와도 같음
df2.drop('우현', inplace = True)
print(df2)

df3 = df[:]
df3.drop(['우현', '인아'], axis = 0, inplace = True)
print(df3)

df4 = df.copy()
df4.drop('수학', axis = 1, inplace = True)
print(df4)

df5 = df.copy()
df5.drop(['영어', '음악'], axis = 1, inplace = True)
print(df5)
>>>     수학  영어   음악   체육
>>> 서준  90  98   85  100
>>> 우현  80  89   95   90
>>> 인아  70  95  100   90
>>>     수학  영어   음악   체육
>>> 서준  90  98   85  100
>>> 인아  70  95  100   90
>>>     수학  영어  음악   체육
>>> 서준  90  98  85  100
>>>     영어   음악   체육
>>> 서준  98   85  100
>>> 우현  89   95   90
>>> 인아  95  100   90
>>>     수학   체육
>>> 서준  90  100
>>> 우현  80   90
>>> 인아  70   90
```

기존의 데이터프레임을 복제하기 위해서 `df[:]`이나 `df.copy()`를 사용하면 된다. 

___

## **행 선택**

데이터프레임의 행 데이터를 선택하기 위해서는 loc, iloc 인덱서를 사용한다.
이 때 인덱스 이름을 기준으로 할 때에는 loc, 정수형 위치 인덱스를 사용할 때에는 iloc를 이용한다.

```python
import pandas as pd
df = pd.DataFrame({'수학':[90, 80, 70], '영어':[98, 89, 95], 
                   '음악':[85, 95, 100], '체육':[100, 90, 90]},
                 index = ['서준', '우현', '인아'])
print(df.loc['서준'])
print(df.iloc[0]) # 객체의 타입이 시리즈임
print(df.loc[['서준', '우현']])
print(df.iloc[[0, 1]]) # 객체의 타입이 데이터프레임임
print(df.loc['서준':'우현'])
print(df.iloc[0:2]) # 객체의 타입이 데이터프레임임
>>> 수학     90
>>> 영어     98
>>> 음악     85
>>> 체육    100
>>> Name: 서준, dtype: int64
>>> 수학     90
>>> 영어     98
>>> 음악     85
>>> 체육    100
>>> Name: 서준, dtype: int64
>>>     수학  영어  음악   체육
>>> 서준  90  98  85  100
>>> 우현  80  89  95   90
>>>     수학  영어  음악   체육
>>> 서준  90  98  85  100
>>> 우현  80  89  95   90
>>>     수학  영어  음악   체육
>>> 서준  90  98  85  100
>>> 우현  80  89  95   90
>>>     수학  영어  음악   체육
>>> 서준  90  98  85  100
>>> 우현  80  89  95   90
```

행을 선택하는 방법에는 크게 3가지가 있다. 1개의 행 선택 / 2개 이상의 행 선택(리스트를 이용한 인덱싱) / 2개 이상의 행 선택 (슬라이싱을 이용한 인덱싱)이다. 이 때 슬라이싱을 이용한 인덱싱에서 주의할 점은 정수형 위치 인덱스의 범위의 끝이 포함되지 않는다는 것이다.

___

## **열 선택**
* 열 1개 선택(시리즈 생성) : DataFrame 객체.['열 이름'] 또는 DataFrame 객체.열 이름
* 열 n개 선택(데이터프레임 생성) : DataFrame 객체[['열1', '열2', ...]]

열 1개를 선택하기 위한 2가지 방법이 있다. 후자는 반드시 열 이름이 문자열일 경우에만 가능하다.<br>
열 n개를 선택하면 대괄호 안에 열 이름의 리스트를 입력한다. 단, 리스트의 원소로 열 이름이 1개만 있는 경우에도 반환되는 객체는 데이터프레임이다.

```python
import pandas as pd
df = pd.DataFrame({'이름':['서준', '우현', '인아'], '수학':[98, 89, 95], 
                   '음악':[85, 95, 100], '체육':[100, 90, 90]})
print(df['수학']) # 반환되는 객체는 시리즈 
print(df.수학)
print(df[['수학']]) # 반환되는 객체는 데이터프레임
print(df[['음악', '체육']])
>>> 0    98
>>> 1    89
>>> 2    95
>>> Name: 수학, dtype: int64
>>> 0    98
>>> 1    89
>>> 2    95
>>> Name: 수학, dtype: int64
>>>    수학
>>> 0  98
>>> 1  89
>>> 2  95
>>>     음악   체육
>>> 0   85  100
>>> 1   95   90
>>> 2  100   90
```

___

## **범위 슬라이싱의 고급 활용**
* 범위 슬라이싱 : DataFrame 객체.iloc[시작 인덱스:끝 인덱스:슬라이싱 간격] 

범위 슬라이싱은 행 선택이나 열 선택 모두 사용할 수 있다.

(ex1) df.iloc[::2] => 2행 간격으로 출력<br>
(ex2) df.iloc[0:3:2] => 0행부터 2행까지 2행 간격으로 출력<br>
(ex3) df.iloc[::-1] => 역순으로 출력

___

## **원소 선택**
* 인덱스 이름 : DataFrame 객체.loc[행 인덱스, 열 이름]
* 정수 위치 인덱스 : DataFrame 객체.iloc[행 번호, 열 번호]

데이터프레임의 행 인덱스와 열 이름을 [행, 열]과 같은 2차원 좌표로 입력하여 원소 위치를 지정하는 방법이다. 1개의 행, 2개 이상의 열 / 2개 이상의 행, 1개의 열을 선택하면 시리즈 객체가 반환되고, 2개 이상의 행과 2개 이상의 열을 선택하면 데이터프레임 객체를 반환한다.

```python
import pandas as pd
df = pd.DataFrame({'이름':['서준', '우현', '인아'], '수학':[90, 80, 70],
                  '영어':[98, 89, 95], '음악':[85, 95, 100], '체육':[100, 90, 90]})
df.set_index('이름', inplace = True) # 열을 행 인덱스로 지정
print(df)
print(df.iloc[0, 2]) # '서준'의 '음악' 점수를 출력
print(df.loc['서준', '음악'])
print(df.iloc[0, 2:]) # '서준'의 '음악', '체육' 점수를 출력
print(df.iloc[0, [2, 3]])
print(df.loc['서준', '음악':])
print(df.loc['서준', ['음악', '체육']])
print(df.iloc[[0, 1], [2, 3]]) # '서준', '우현'의 '음악', '체육' 점수를 선택
print(df.iloc[0:2, 2:])
print(df.loc[['서준','우현'], ['음악', '체육']])
print(df.loc['서준':'우현', '음악':'체육'])
```

1개의 원소를 선택할 때에는 [행, 열]을 넣어주면 되고, 2개 이상의 원소를 선택할 때에는 리스트로 인덱스 배열 입력, 슬라이싱 등 다양한 방법을 이용해서 선택할 수 있다. 

___

## **열 추가**
* DataFrame 객체['추가하려는 열 이름'] = 데이터 값

데이터프레임의 열을 추가하기 위해서는 추가하려는 열 이름과 데이터 값을 위와 같이 입력해준다. 이 때 주의해야 할 점은 `모든 행에 동일한 값이 입력된다는 것이다`.

```python
import pandas as pd
df = pd.DataFrame({'이름':['서준', '우현', '인아'], '수학':[90, 80, 70], 
                  '영어':[98, 89, 95], '음악':[85, 95, 100], '체육':[100, 90, 90]})
df['국어'] = 80
print(df)
>>>    이름  수학  영어   음악   체육  국어
>>> 0  서준  90  98   85  100  80
>>> 1  우현  80  89   95   90  80
>>> 2  인아  70  95  100   90  80
```

___

## **행 추가**
* 행 추가 : DataFrame.loc['새로운 행 이름'] = 데이터 값 (혹은 배열)

행을 추가하기 위해서는 loc 인덱서를 사용하여 입력한다. 또한, 행 벡터 자체가 배열이므로 기존 행을 복사해서 새로운 행에 그대로 추가할 수도 있다.
* 주의해야 할 점<br>
1. 기존의 행 인덱스와 겹치지 않는 새로운 인덱스를 사용한다. 만약 기존의 인덱스를 사용한다면 기존 행의 원소값을 변경한다.
2. 행 인덱스 지정 시 기존 인덱스의 순서를 굳이 따르지 않아도 됨

```python
import pandas as pd
df = pd.DataFrame({'이름':['서준', '우현', '인아'], '수학':[90, 80, 70], 
                  '영어':[98, 89, 95], '음악':[85, 95, 100], '체육':[100, 90, 90]})
df.loc[3] = 0
df.loc[4] = ['동규', 90, 80, 70, 60]
df.loc['행5'] = df.loc[3]
print(df)
>>>     이름  수학  영어   음악   체육
>>> 0   서준  90  98   85  100
>>> 1   우현  80  89   95   90
>>> 2   인아  70  95  100   90
>>> 3    0   0   0    0    0
>>> 4   동규  90  80   70   60
>>> 행5   0   0   0    0    0
```

___

## **원소 값 변경**
* 원소 값 변경 : DataFrame 객체의 일부분 또는 원소를 선택 = 새로운 값

원소 값 변경을 위해서는 앞에서 원소 선택을 할 때 loc, iloc 인덱서를 사용했던 것처럼 원소를 선택해주고 새로운 값을 지정해주면 된다.

```python
import pandas as pd
df = pd.DataFrame({'이름':['서준', '우현', '인아'], '수학':[90, 80, 70], 
                  '영어':[98, 89, 95], '음악':[85, 95, 100], '체육':[100, 90, 90]})
df.set_index('이름', inplace = True)
df.iloc[0, 3] = 80 # '서준'의 '체육' 점수를 80으로 변경
df.loc['서준', '체육'] = 100 
df.loc['서준', ['음악', '체육']] = 50 # '서준'의 '음악', '체육' 점수를 50점으로 변경
df.loc['서준', ['음악', '체육']] = 100, 50 # '서준'의 '음악', '체육' 점수를 100, 50점으로 변경
```
___

## **행, 열의 위치 바꾸기**
* 행, 열 바꾸기 : DataFrame 객체.transpose() 또는 DataFrame 객체.T

이는 데이터프레임의 행과 열을 바꾸는, 즉 전치행렬과 같은 개념이다. 전치의 결과로 새로운 객체를 반환하므로 새로운 변수에 할당을 해주는 과정이 필요하다. 또한, 알다시피 전치를 2번 해주면 원래 데이터프레임으로 돌아온다.

```python
import pandas as pd
df = pd.DataFrame({'이름':['서준', '우현', '인아'], '수학':[90, 80, 70], 
                  '영어':[98, 89, 95], '음악':[85, 95, 100], '체육':[100, 90, 90]})
df = df.transpose()
df = df.T
```
